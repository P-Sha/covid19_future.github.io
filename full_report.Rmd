---
title: "Full Report"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 4
    css: style.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(plotly)
library(ggplot2)
library(dygraphs)
library(rvest)
library(httr)
library(readxl)
library(tidyquant)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

### Motivation and Goals

As of the beginning of November 2020, the total deaths due to COVID-19 surpassed [1.3 million](https://covid19.who.int/) globally. Further, as reported by WHO, the total confirmed cases exceeded 57.8 million worldwide. 

#### _Motivation_

Given the scale of this pandemic, the project was inspired by the idea of trying to understand its direction by comparing it to prior pandemics. With uncertainty and anxiety accompanying it, and no definitive foreseeable future, we were interested in exploring how the previous similar pandemics, caused by similar pathogens, turned out over time.       

#### _Goals_

By undertaking this project, we were hoping to identify and establish any existing pattern in past outbreaks, and then to look for predictability in possible direction(s) COVID-19 could turn to in the near future. 

### Related work

The idea for the project was encouraged by the articles ["How the pandemic might play out in 2021 and beyond"](https://www.nature.com/articles/d41586-020-02278-5), and ["Here's how the COVID-19 pandemic could play out over the next two years"](https://www.livescience.com/covid-19-pandemic-future-scenarios.html).

### Questions

#### _Initial_

The questions of interest were to investigate on the expected severity of COVID-19 based on information provided by prior pandemics, and to predict the length and direction of the current pandemic based on the history of similar infectious pandemics. Evaluation of time-series was the primary focus of the project, intially.

#### _Additional_

What might the basic reproductive rates had been in the past pandemics? Basic reproductive rate, or "r0" for short, is a measure that describes the ability of a pathogen to spread in a population. It is the average of secondary infections caused by an infectious individual; which we thought is a critical element in pandemics analyses.  

[How did these questions evolve over the course of the project? What new questions did you consider in the course of your analysis?]

### Data

Multiple datasets were used from various shareable online sources for analysis and comparison to COVID-19. Complete list of data-descriptions is provided under the "Datasets" tab. 


Most of the datasets were available in ready-to-use CSV formats, requiring some basic manipulations to get them in a readable and tidy format. Since up-to-date data is important in analysis of prior pandemic trends, data scraping from [the CDC website](data.cdc.gov) for updated COVID-19 data was used. Data scraping was done using JSON APIs with the `GET` function from the `httr` package, along with the `fromJSON()` function from the `jsonlite` package.

<brk><brk><brk>

   Data for COVID-19 in Chicago required filtering the peak timeframe, up until the completion of this report (December 4th 2020), by weeks. This combined dataframe was then compared to the available Spanish flu record of 7 weeks.   
  
<brk><brk><brk>

  Also, the data with R0 and other statistical comparisons between the four pandemics was extracted by scraping [thelancet.com](https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(20)30484-9/fulltext). Scraped data first had to be saved as a dataframe in order to make it compatible with the rest of the website. Information on R0 for the four pandemics, incubation period, interval between symptoms to infectivity, and proportion with mild illness was retained and formatted into a table. Data was again reformatted to long in order to show r0 by disease-type graphically. 
  
<brk><brk><brk>

After the preliminary steps were taken to get the datasets in working forms, all the data files were then stored in `.rda` compressed format for easy access and reproducibility across the site.

<brk><brk><brk>

Data for `Shiny Dashboard` ...


### Exploratory Analysis

Given the rapidly changing dynamics on a daily basis of the current Coronavirus, the analysis of COVID-19 would understandably need an ongoing update as well for a complete and thorough comparisons. Nevertheless, the comparisons did provide some understanding on how pandemics shape out in general, and helped relieve some anxiety and uncertainty regarding them. Hopefully, it will do the same for our readers.

<brk><brk><brk>

We started our analysis by comparing the first pandemic of the 20th century, named Spanish flu, which has its descendant virus remaining till today as [influenza virus](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6187799/). Although the first historically documented pandemic was the Plague of 430 B.C., not much of the recorded data is available for pandemics prior to the 20th century. Recently, efforts have been made to understand the disease history by studying remnants of human remains such as the teeth. Paleontologists and scientists have identified the DNA of the bacteria that caused the [Black Death pandemic over 5,000 years ago](https://www.washingtonpost.com/health/ancient-teeth-show-history-of-epidemics-is-much-older-than-we-thought/2020/07/24/4f18ed94-b641-11ea-a8da-693df3d7674a_story.html).  
<brk><brk><brk>

Spanish flu was a viral infection just as covid-19, which lasted from early 1918 to spring of 1920. With the data available, or lack of, we were able to compare its impact in Chicago. Data was recorded at the peak of the outbreak, for 7 weeks. For parallel comparison, data was extracted for peak 7 weeks as well for covid-19, from the City of Chicago databank.  

```{r}
# Spanish flu versus COVID-19

## Spanish flu data

spanish_rawdf = read.csv("./data/spanish_flu_chicago.csv") 

save(spanish_rawdf, file = "spanish_rawdf.rda")

spanish_df = 
  spanish_rawdf %>% 
  janitor::clean_names() %>% 
  group_by(week) %>% 
  summarize(mortality = n())

plot_1 =
spanish_df %>% 
   plot_ly(
    x = ~week, y = ~mortality, color = ~mortality, type = "bar") %>% 
   layout(title = "Spanish Flu")

## Covid-19 Chicago data

covid19_chicago_rawdf =  read.csv("./data/covid19_chicago.csv") 

save(covid19_chicago_rawdf, file = "covid19_chicago_rawdf.rda")

covid19_chicago =
  covid19_chicago_rawdf %>% 
  janitor::clean_names() %>% 
  filter(deaths_total != 0) %>% 
  mutate(
    date = as.Date(date, "%m/%d/%y")
  ) 
  
 row1 = covid19_chicago %>%  
     filter(date >= as.Date("2020-04-07") & date <= as.Date("2020-04-13")) %>% 
     summarize(
       week = 1,
       mortality = sum(deaths_total))
 
 row2 = covid19_chicago %>%  
     filter(date >= as.Date("2020-04-14") & date <= as.Date("2020-04-20")) %>% 
     summarize(
       week = 2,
        mortality = sum(deaths_total))
 
 row3 = covid19_chicago %>%  
     filter(date >= as.Date("2020-04-21") & date <= as.Date("2020-04-27")) %>% 
     summarize(
       week = 3,
        mortality = sum(deaths_total))
 
 row4 = covid19_chicago %>%  
     filter(date >= as.Date("2020-04-28") & date <= as.Date("2020-05-04")) %>% 
     summarize(
       week = 4,
        mortality = sum(deaths_total))
 
 row5 = covid19_chicago %>%  
     filter(date >= as.Date("2020-05-05") & date <= as.Date("2020-05-11")) %>% 
     summarize(
       week = 5,
        mortality = sum(deaths_total))
 
 row6 = covid19_chicago %>%  
     filter(date >= as.Date("2020-05-12") & date <= as.Date("2020-05-18")) %>% 
     summarize(
       week = 6,
        mortality = sum(deaths_total))
 
 row7 = covid19_chicago %>%  
     filter(date >= as.Date("2020-05-19") & date <= as.Date("2020-05-25")) %>% 
     summarize(
       week = 7,
        mortality = sum(deaths_total))
 
 covid19_chicago_df = bind_rows(row1, row2, row3, row4, row5, row6, row7)
 
plot_2 = 
  covid19_chicago_df %>% 
  plot_ly(
    x = ~week, y = ~ mortality, color = ~ mortality, type = "bar") %>% 
  layout(title = "Spanish Flu (left) vs COVID-19: Peak 7 weeks (Chicago)")

# Comparison-plot

subplot(plot_1, plot_2, shareX = TRUE,  shareY = TRUE)
```

The graphs show similar curves in terms of shape, with the peak of maximum mortality due to Spanish flu in a week over 6 times the mortality of the current pandemic. Tracing the bars displays total mortality for a given week.  

Next we compared the first pandemic of the 21st century, Severe acute respiratory syndrome or SARS-2003 for short, to COVID-19. With better records of data collection and availability by then, we were able to analyze the history of SARS at a global scale and were able to compare it to COVID-19 at a greater detail. 

```{r}
# SARS 2003 global cumulative cases 

load("./sars_df.rda")

sars_df %>%
  ggplot(aes(x = date, y = deaths_cum, color = country)) +
  geom_line() +
  xlab("month") +
  ylab("cumulative deaths") +
  ggtitle("SARS 2003 cumulative deaths by country")
```

As the graph displays, SARS was a worldwide pandemic, with majority of death toll in eastern part of the world such as China and Hong Kong. A fast-spreading albeit short-lived pandemic, it was contained within 5 months for the most part. According to the [CDC](htts://www.cdc.gov/sars/about/fs-sars.html), the first reported case was in February of 2003 in Asia. It did not spread as widely in the western countries, or much at all in the U.S.








(Visualizations, summaries, and exploratory statistical analyses. Justify the steps you took, and show any major changes to your ideas.)

*Sars, Spanish Flu, H1N1, Influenza B, COVID-19 Analysis

### Additional analysis: If you undertake formal statistical analyses, describe these in detail - maybe?

### Discussion
Discuss results.
What were your findings? Are they what you expect? What insights into the data can you make?



***
Authors: _Jared Klug_ | _David Nemirovsky_ | _Matthew Lawlor_ | _Purnima Sharma_ 

Students (Data Science, Fall 2020): ![](pictures/Logo.png) 
